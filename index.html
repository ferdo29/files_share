<!doctype html>
<html lang="ru">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Audio CDN</title>
<style>
  :root { --pad: 16px; }
  body{font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:2rem; max-width:900px}
  header{display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:.5rem}
  .tip{font-size:14px; color:#555}
  .grid{display:grid; gap:12px; margin-top:1rem}
  .file{padding:var(--pad); border:1px solid #ddd; border-radius:14px}
  .file a{display:inline-block; margin:.25rem .5rem .25rem 0}
  audio{width:100%; margin-top:.5rem}
  .search{display:flex; gap:.5rem; margin-top:.5rem}
  input[type="search"]{flex:1; padding:.6rem .8rem; border:1px solid #ccc; border-radius:10px}
  .muted{opacity:.8}
</style>
<header>
  <h1>MP3 каталог</h1>
  <div class="tip">Файлы из <code>/audio</code>. Манифест: <code>/audio/manifest.json</code></div>
</header>

<div class="search">
  <input id="q" type="search" placeholder="Фильтр по названию…" aria-label="Поиск">
</div>

<div id="list" class="grid">Загружаю…</div>

<script>
(async () => {
  const resp = await fetch('./audio/manifest.json');
  if (!resp.ok) {
    document.getElementById('list').textContent = 'Не удалось загрузить manifest.json';
    return;
  }
  const { baseUrl, files } = await resp.json();
  const list = document.getElementById('list');
  const q = document.getElementById('q');

  function render(items){
    list.innerHTML = '';
    if (!items.length) {
      list.innerHTML = '<div class="muted">Пусто</div>';
      return;
    }
    for (const f of items) {
      const url = baseUrl + encodeURIComponent(f.name);
      const div = document.createElement('div');
      div.className = 'file';
      div.innerHTML = `
        <strong>${f.title || f.name}</strong>
        <div class="muted">${f.name}</div>
        <div>
          <a href="${url}" download>Скачать</a>
          <a href="${url}" target="_blank" rel="noopener">Открыть</a>
        </div>
        <audio controls preload="none" src="${url}"></audio>
      `;
      list.appendChild(div);
    }
  }

  render(files);

  q.addEventListener('input', () => {
    const term = q.value.trim().toLowerCase();
    render(files.filter(f =>
      (f.title || '').toLowerCase().includes(term) ||
      (f.name || '').toLowerCase().includes(term)
    ));
  });
})();
</script>
</html>
